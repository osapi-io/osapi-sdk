<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# orchestrator

```go
import "github.com/osapi-io/osapi-sdk/pkg/orchestrator"
```

Package orchestrator provides DAG\-based task orchestration primitives.

## Index

- [Variables](<#variables>)
- [type ErrorStrategy](<#ErrorStrategy>)
  - [func Retry\(n int\) ErrorStrategy](<#Retry>)
  - [func \(e ErrorStrategy\) RetryCount\(\) int](<#ErrorStrategy.RetryCount>)
  - [func \(e ErrorStrategy\) String\(\) string](<#ErrorStrategy.String>)
- [type GuardFn](<#GuardFn>)
- [type Hooks](<#Hooks>)
- [type Op](<#Op>)
- [type Plan](<#Plan>)
  - [func NewPlan\(client \*osapi.Client, opts ...PlanOption\) \*Plan](<#NewPlan>)
  - [func \(p \*Plan\) Client\(\) \*osapi.Client](<#Plan.Client>)
  - [func \(p \*Plan\) Config\(\) PlanConfig](<#Plan.Config>)
  - [func \(p \*Plan\) Explain\(\) string](<#Plan.Explain>)
  - [func \(p \*Plan\) Levels\(\) \(\[\]\[\]\*Task, error\)](<#Plan.Levels>)
  - [func \(p \*Plan\) Run\(ctx context.Context\) \(\*Report, error\)](<#Plan.Run>)
  - [func \(p \*Plan\) Task\(name string, op \*Op\) \*Task](<#Plan.Task>)
  - [func \(p \*Plan\) TaskFunc\(name string, fn TaskFn\) \*Task](<#Plan.TaskFunc>)
  - [func \(p \*Plan\) Tasks\(\) \[\]\*Task](<#Plan.Tasks>)
  - [func \(p \*Plan\) Validate\(\) error](<#Plan.Validate>)
- [type PlanConfig](<#PlanConfig>)
- [type PlanOption](<#PlanOption>)
  - [func OnError\(strategy ErrorStrategy\) PlanOption](<#OnError>)
  - [func WithHooks\(hooks Hooks\) PlanOption](<#WithHooks>)
- [type Report](<#Report>)
  - [func \(r \*Report\) Summary\(\) string](<#Report.Summary>)
- [type Result](<#Result>)
- [type Results](<#Results>)
  - [func \(r Results\) Get\(name string\) \*Result](<#Results.Get>)
- [type Status](<#Status>)
- [type Task](<#Task>)
  - [func NewTask\(name string, op \*Op\) \*Task](<#NewTask>)
  - [func NewTaskFunc\(name string, fn TaskFn\) \*Task](<#NewTaskFunc>)
  - [func \(t \*Task\) Dependencies\(\) \[\]\*Task](<#Task.Dependencies>)
  - [func \(t \*Task\) DependsOn\(deps ...\*Task\) \*Task](<#Task.DependsOn>)
  - [func \(t \*Task\) ErrorStrategy\(\) \*ErrorStrategy](<#Task.ErrorStrategy>)
  - [func \(t \*Task\) Fn\(\) TaskFn](<#Task.Fn>)
  - [func \(t \*Task\) Guard\(\) GuardFn](<#Task.Guard>)
  - [func \(t \*Task\) IsFunc\(\) bool](<#Task.IsFunc>)
  - [func \(t \*Task\) Name\(\) string](<#Task.Name>)
  - [func \(t \*Task\) OnError\(strategy ErrorStrategy\)](<#Task.OnError>)
  - [func \(t \*Task\) OnlyIfChanged\(\)](<#Task.OnlyIfChanged>)
  - [func \(t \*Task\) Operation\(\) \*Op](<#Task.Operation>)
  - [func \(t \*Task\) RequiresChange\(\) bool](<#Task.RequiresChange>)
  - [func \(t \*Task\) When\(fn GuardFn\)](<#Task.When>)
- [type TaskFn](<#TaskFn>)
- [type TaskResult](<#TaskResult>)


## Variables

<a name="Continue"></a>Continue skips dependents of the failed task but continues independent tasks.

```go
var Continue = ErrorStrategy{/* contains filtered or unexported fields */}
```

<a name="StopAll"></a>StopAll cancels all remaining tasks on first failure.

```go
var StopAll = ErrorStrategy{/* contains filtered or unexported fields */}
```

<a name="ErrorStrategy"></a>
## type ErrorStrategy

ErrorStrategy defines how the runner handles task failures.

```go
type ErrorStrategy struct {
    // contains filtered or unexported fields
}
```

<a name="Retry"></a>
### func Retry

```go
func Retry(n int) ErrorStrategy
```

Retry returns a strategy that retries a failed task n times before failing.

<a name="ErrorStrategy.RetryCount"></a>
### func \(ErrorStrategy\) RetryCount

```go
func (e ErrorStrategy) RetryCount() int
```

RetryCount returns the number of retries for this strategy.

<a name="ErrorStrategy.String"></a>
### func \(ErrorStrategy\) String

```go
func (e ErrorStrategy) String() string
```

String returns a human\-readable representation of the strategy.

<a name="GuardFn"></a>
## type GuardFn

GuardFn is a predicate that determines if a task should run.

```go
type GuardFn func(results Results) bool
```

<a name="Hooks"></a>
## type Hooks

Hooks provides consumer\-controlled callbacks for plan execution events. All fields are optional â€” nil callbacks are skipped. The SDK performs no logging; hooks are the only output mechanism.

```go
type Hooks struct {
    BeforePlan  func(explain string)
    AfterPlan   func(report *Report)
    BeforeLevel func(level int, tasks []*Task, parallel bool)
    AfterLevel  func(level int, results []TaskResult)
    BeforeTask  func(task *Task)
    AfterTask   func(task *Task, result TaskResult)
    OnRetry     func(task *Task, attempt int, err error)
    OnSkip      func(task *Task, reason string)
}
```

<a name="Op"></a>
## type Op

Op represents a declarative SDK operation.

```go
type Op struct {
    Operation string
    Target    string
    Params    map[string]any
}
```

<a name="Plan"></a>
## type Plan

Plan is a DAG of tasks with dependency edges.

```go
type Plan struct {
    // contains filtered or unexported fields
}
```

<a name="NewPlan"></a>
### func NewPlan

```go
func NewPlan(client *osapi.Client, opts ...PlanOption) *Plan
```

NewPlan creates a new plan bound to an OSAPI client.

<a name="Plan.Client"></a>
### func \(\*Plan\) Client

```go
func (p *Plan) Client() *osapi.Client
```

Client returns the OSAPI client bound to this plan.

<a name="Plan.Config"></a>
### func \(\*Plan\) Config

```go
func (p *Plan) Config() PlanConfig
```

Config returns the plan configuration.

<a name="Plan.Explain"></a>
### func \(\*Plan\) Explain

```go
func (p *Plan) Explain() string
```

Explain returns a human\-readable representation of the execution plan showing levels, parallelism, dependencies, and guards.

<a name="Plan.Levels"></a>
### func \(\*Plan\) Levels

```go
func (p *Plan) Levels() ([][]*Task, error)
```

Levels returns the levelized DAG \-\- tasks grouped into execution levels where all tasks in a level can run concurrently. Returns an error if the plan fails validation.

<a name="Plan.Run"></a>
### func \(\*Plan\) Run

```go
func (p *Plan) Run(ctx context.Context) (*Report, error)
```

Run validates the plan, resolves the DAG, and executes tasks.

<a name="Plan.Task"></a>
### func \(\*Plan\) Task

```go
func (p *Plan) Task(name string, op *Op) *Task
```

Task creates a declarative task, adds it to the plan, and returns it.

<a name="Plan.TaskFunc"></a>
### func \(\*Plan\) TaskFunc

```go
func (p *Plan) TaskFunc(name string, fn TaskFn) *Task
```

TaskFunc creates a functional task, adds it to the plan, and returns it.

<a name="Plan.Tasks"></a>
### func \(\*Plan\) Tasks

```go
func (p *Plan) Tasks() []*Task
```

Tasks returns all tasks in the plan.

<a name="Plan.Validate"></a>
### func \(\*Plan\) Validate

```go
func (p *Plan) Validate() error
```

Validate checks the plan for errors: duplicate names and cycles.

<a name="PlanConfig"></a>
## type PlanConfig

PlanConfig holds plan\-level configuration.

```go
type PlanConfig struct {
    OnErrorStrategy ErrorStrategy
    Hooks           *Hooks
}
```

<a name="PlanOption"></a>
## type PlanOption

PlanOption is a functional option for NewPlan.

```go
type PlanOption func(*PlanConfig)
```

<a name="OnError"></a>
### func OnError

```go
func OnError(strategy ErrorStrategy) PlanOption
```

OnError returns a PlanOption that sets the default error strategy.

<a name="WithHooks"></a>
### func WithHooks

```go
func WithHooks(hooks Hooks) PlanOption
```

WithHooks attaches lifecycle callbacks to plan execution.

<a name="Report"></a>
## type Report

Report is the aggregate output of a plan execution.

```go
type Report struct {
    Tasks    []TaskResult
    Duration time.Duration
}
```

<a name="Report.Summary"></a>
### func \(\*Report\) Summary

```go
func (r *Report) Summary() string
```

Summary returns a human\-readable summary of the report.

<a name="Result"></a>
## type Result

Result is the outcome of a single task execution.

```go
type Result struct {
    Changed bool
    Data    map[string]any
}
```

<a name="Results"></a>
## type Results

Results is a map of task name to Result, used for conditional logic.

```go
type Results map[string]*Result
```

<a name="Results.Get"></a>
### func \(Results\) Get

```go
func (r Results) Get(name string) *Result
```

Get returns the Result for the named task, or nil if not found.

<a name="Status"></a>
## type Status

Status represents the outcome of a task execution.

```go
type Status string
```

<a name="StatusPending"></a>Task execution statuses.

```go
const (
    StatusPending   Status = "pending"
    StatusRunning   Status = "running"
    StatusChanged   Status = "changed"
    StatusUnchanged Status = "unchanged"
    StatusSkipped   Status = "skipped"
    StatusFailed    Status = "failed"
)
```

<a name="Task"></a>
## type Task

Task is a unit of work in an orchestration plan.

```go
type Task struct {
    // contains filtered or unexported fields
}
```

<a name="NewTask"></a>
### func NewTask

```go
func NewTask(name string, op *Op) *Task
```

NewTask creates a declarative task wrapping an SDK operation.

<a name="NewTaskFunc"></a>
### func NewTaskFunc

```go
func NewTaskFunc(name string, fn TaskFn) *Task
```

NewTaskFunc creates a functional task with custom logic.

<a name="Task.Dependencies"></a>
### func \(\*Task\) Dependencies

```go
func (t *Task) Dependencies() []*Task
```

Dependencies returns the task's dependencies.

<a name="Task.DependsOn"></a>
### func \(\*Task\) DependsOn

```go
func (t *Task) DependsOn(deps ...*Task) *Task
```

DependsOn sets this task's dependencies. Returns the task for chaining.

<a name="Task.ErrorStrategy"></a>
### func \(\*Task\) ErrorStrategy

```go
func (t *Task) ErrorStrategy() *ErrorStrategy
```

ErrorStrategy returns the per\-task error strategy, or nil to use the plan default.

<a name="Task.Fn"></a>
### func \(\*Task\) Fn

```go
func (t *Task) Fn() TaskFn
```

Fn returns the task function, or nil for declarative tasks.

<a name="Task.Guard"></a>
### func \(\*Task\) Guard

```go
func (t *Task) Guard() GuardFn
```

Guard returns the guard function, or nil if none is set.

<a name="Task.IsFunc"></a>
### func \(\*Task\) IsFunc

```go
func (t *Task) IsFunc() bool
```

IsFunc returns true if this is a functional task.

<a name="Task.Name"></a>
### func \(\*Task\) Name

```go
func (t *Task) Name() string
```

Name returns the task name.

<a name="Task.OnError"></a>
### func \(\*Task\) OnError

```go
func (t *Task) OnError(strategy ErrorStrategy)
```

OnError sets a per\-task error strategy override.

<a name="Task.OnlyIfChanged"></a>
### func \(\*Task\) OnlyIfChanged

```go
func (t *Task) OnlyIfChanged()
```

OnlyIfChanged marks this task to only run if at least one dependency reported Changed=true.

<a name="Task.Operation"></a>
### func \(\*Task\) Operation

```go
func (t *Task) Operation() *Op
```

Operation returns the declarative operation, or nil for functional tasks.

<a name="Task.RequiresChange"></a>
### func \(\*Task\) RequiresChange

```go
func (t *Task) RequiresChange() bool
```

RequiresChange returns true if OnlyIfChanged was set.

<a name="Task.When"></a>
### func \(\*Task\) When

```go
func (t *Task) When(fn GuardFn)
```

When sets a custom guard function that determines whether this task should execute.

<a name="TaskFn"></a>
## type TaskFn

TaskFn is the signature for functional tasks. The client parameter provides access to the OSAPI SDK for making API calls.

```go
type TaskFn func(
    ctx context.Context,
    client *osapi.Client,
) (*Result, error)
```

<a name="TaskResult"></a>
## type TaskResult

TaskResult records the full execution details of a task.

```go
type TaskResult struct {
    Name     string
    Status   Status
    Changed  bool
    Duration time.Duration
    Error    error
}
```

Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)
